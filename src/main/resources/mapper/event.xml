<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.multi.hereevent.event">
    <select id="insertEvent" parameterType="event">
        insert into event(name,start_date,end_date,addr,info,homepage,sns,type,reserve_limit,wait_limit)
        value(event_seq.nextval,#{name},#{start_date},#{end_date},#{addr},#{info},#{homepage},#{sns},#{type},#{reserve_limit},#{wait_limit})
    </select>
    <select id="deleteEvent" parameterType="String">
        delete from event where event_no = #{event_no}
    </select>
    <select id="updateEvent" parameterType="event">
        update event
        set name = #{name}, start_date = #{start_date}, end_date = #{end_date},
        addr = #{addr}, info = #{info}, reserve_limit = #{reserve_limit},wait_limit = #{wait_limit}
        where event_no = #{event_no}
    </select>
    <select id="searchEvent" parameterType="String" resultType="event">
        select * from event
        where name like '%' || #{name} || '%'
    </select>
    <select id="getAllEvent" resultType="event">
        select * from event
        where type = 0
    </select>
    <select id="getOpenEvent" resultType="event">
        SELECT event_no, category_no, name, start_date, end_date, addr, info, homepage, sns, img_path, type, reserve_limit, wait_limit
        FROM event
        WHERE start_date > sysdate
    </select>
    <select id="getPopularEvent" resultType="event">
        SELECT e.event_no, count(r.member_no)+count(w.email)
        FROM event e, reserve r, wait w
        WHERE e.event_no = r.event_no and
        e.event_no = w.event_no
        GROUP BY event_no
        ORDER BY event_no desc
    </select>

    <select id="getEventDetails" resultType="event">
        SELECT event_no, category_no, name, start_date, end_date,addr, info, homepage, sns, img_path, type, reserve_limit, wait_limit
        FROM event
        WHERE event_no = #{event_no}
    </select>
<!--  event photo 가져오기  -->
    <select id="getEventImage" resultType="com.multi.hereevent.dto.EventDTO">
        SELECT event_no, image_path
        FROM events
        WHERE event_no = #{eventNo}
    </select>

	<insert id="insertCrawlingEvent" parameterType="event">
		insert into event  (name, start_date, end_date, addr, info, homepage, sns, img_path)
		select #{name}, #{start_date}, #{end_date}, #{addr}, #{info}, #{homepage}, #{sns}, #{img_path}
		from dual where not exists (
			select event_no
			from event
			where name=#{name} and start_date=#{start_date} and end_date=#{end_date} and addr=#{addr})
	</insert>
	<select id="selectEventNoByEventName" parameterType="String" resultType="String">
		select event_no
		from event
		where name=#{name}
	</select>
  
</mapper>